Please don't use this code as reference! It is very messy.
